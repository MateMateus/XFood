@model IEnumerable<xFood.Application.DTOs.ProductDto>
@using Microsoft.AspNetCore.Mvc.Rendering
@{
    ViewData["Title"] = "Produtos";
    var categories = (SelectList)ViewBag.Categories;
    var role = Context.Session.GetString("UserRole");
    bool isAdmin = string.Equals(role, "Admin", StringComparison.OrdinalIgnoreCase);
    bool isManager = string.Equals(role, "Manager", StringComparison.OrdinalIgnoreCase);
}
<h2 class="mb-3">Produtos</h2>

<form method="get" class="row g-2 align-items-end mb-3">
    <div class="col-auto">
        <label class="form-label">Categoria</label>
        <select name="categoryId" class="form-select" asp-items="categories">
            <option value="">Todas</option>
        </select>
    </div>
    <div class="col-auto">
        <label class="form-label">Buscar</label>
        <input type="text" name="q" class="form-control" value="@Context.Request.Query["q"]" placeholder="nome/descrição" />
    </div>
    <div class="col-auto">
        <button class="btn btn-secondary">Filtrar</button>
        <a class="btn btn-outline-secondary" href="@Url.Action("Index")">Limpar</a>
        <a class="btn btn-primary" href="@Url.Action("Create")">Novo Produto</a>
    </div>
</form>

<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th style="width:80px">Imagem</th>
            <th>Nome</th>
            <th>Categoria</th>
            <th class="text-end">Preço</th>
            <th class="text-end">Estoque</th>
            <th class="text-end" style="width:220px">
                Ações
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var p in Model)
        {
            <tr>
                <td>
                    @if (!string.IsNullOrEmpty(p.ImageUrl))
                    {
                        <img src="@p.ImageUrl" alt="thumb" class="rounded border"
                             style="width:64px;height:64px;object-fit:cover" />
                    }
                    else
                    {
                        <div class="bg-light border rounded" style="width:64px;height:64px"></div>
                    }
                </td>
                <td>@p.Name</td>
                <td>@p.CategoryName</td>
                <td class="text-end">@p.Price.ToString("c")</td>
                <td class="text-end">@p.Stock</td>
                <td class="text-end">
                    <a class="btn btn-sm btn-info" href="@Url.Action("Details", new { id = p.Id, @return = "/#products" })">Details</a>

                    @if (isAdmin || isManager)
                    {
                        <a class="btn btn-sm btn-warning" href="@Url.Action("Edit", new { id = p.Id, @return = "/#products" })">Editar</a>
                    }

                    @if (isAdmin)
                    {
                        <a class="btn btn-sm btn-danger" href="@Url.Action("Delete", new { id = p.Id, @return = "/#products" })">Excluir</a>
                    }
                </td>

            </tr>
        }
    </tbody>
</table>
